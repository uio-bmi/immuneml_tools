<tool id="immuneml_simulation" name="Simulate immune events with LIgO" version="@VERSION@.0">
  <description></description>
    <macros>
        <import>prod_macros.xml</import>
    </macros>
    <expand macro="requirements" />
  <command><![CDATA[
 
      #if $iml_input
         cp -r ${iml_input.extra_files_path}/result/* . &&
	 (mv repertoires/* . &>/dev/null || :) &&
	 rm -rf repertoires &&
      #end if
      
      cp "$yaml_input" yaml_copy &&
      immune-ml ./yaml_copy ${html_outfile.files_path} --tool GalaxySimulationTool &&

      mv ${html_outfile.files_path}/index.html ${html_outfile} && 
      mv ${html_outfile.files_path}/immuneML_output.zip $archive 

      ]]>
  </command>
  <inputs>
      <param name="iml_input" type="data" format="immuneml_receptors" label="immuneML dataset" optional="true" help="This field accepts datasets in the ImmuneML format, as created by the Create Dataset tool."/>
      <param name="yaml_input" type="data" format="txt" label="YAML specification" multiple="false"/>
  </inputs>
    <outputs>
        <data format="zip" name="archive" label="Archive: immune signal simulation"/>
        <data format="immuneml_receptors" name="html_outfile" label="Simulated immuneML dataset"/>
    </outputs>


  <help><![CDATA[

        This tool generates synthetic immune receptor datasets (either on repertoire, receptor or sequence level)
        with different immune events and known ground-truth.

        The simulation setup is flexible and allows the simulation of immune signals (sets of (gapped) k-mers or
        positional weight matrices with optional V/J gene information and sequence position) and immune events (labels
        on top of immune signals that could correspond to specific-diseases on the repertoire level).

        The resulting dataset is fully annotated on the sequence level with immune signals and events.

        For the exhaustive documentation of this tool and an example YAML specification, see the tutorial `How to simulate AIRR datasets in Galaxy <https://docs.immuneml.uio.no/latest/galaxy/galaxy_simulate_signals.html>`_.

        For more information on the simulation, see the original manuscript:

        Chernigovskaya, M., PavloviÄ‡, M., Kanduri, C., Gielis, S., Robert, P. A., Scheffer, L., Slabodkin, A.,
        Haff, I. H., Meysman, P., Yaari, G., Sandve, G. K., & Greiff, V. (2023). Simulation of adaptive immune
        receptors and repertoires with complex immune information to guide the development and benchmarking of
        AIRR machine learning (p. 2023.10.20.562936). bioRxiv. https://doi.org/10.1101/2023.10.20.562936


        **Tool output**

        This Galaxy tool will produce the following history elements:

        - ImmuneML dataset: a dataset which can be used as an input to other immuneML tools. The history element contains a summary HTML page describing general characteristics of the dataset, including the name of the dataset
          (which is used in the dataset definition of a yaml specification), the dataset type and size, available labels, and a link to download the raw data files.

        - Archive: LIgO simulation: a .zip file containing the complete output folder as it was produced by immuneML and LIgO. This folder
          contains the output of the LigoSim instruction including all raw data files.
          Furthermore, the folder contains the complete YAML specification file for the immuneML run, the HTML output and a log file.


    ]]>
  </help>

</tool>
